# ุงูุชุญูู ูู ุฅุตูุงุญุงุช ุชุญุณูู ุงูุฐุงูุฑุฉ

## โ ูุงุฆูุฉ ุงูุชุญูู

### 1๏ธโฃ ุงูุชุญูู ูู ุงูููุงุฑุณ

**ุงููููุน:** Supabase Dashboard โ SQL Editor

**ุงูุฃูุฑ:**

```sql
SELECT
  indexname,
  tablename,
  indexdef
FROM pg_indexes
WHERE tablename = 'hv_payments'
ORDER BY indexname;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ูุฌุจ ุฃู ุชุฑู 5 ููุงุฑุณ ุฌุฏูุฏุฉ:

- โ `idx_hv_payments_worker_id`
- โ `idx_hv_payments_saved_at_desc`
- โ `idx_hv_payments_worker_saved`
- โ `idx_hv_payments_verification_id`
- โ `idx_hv_payments_worker_saved_amount`

---

### 2๏ธโฃ ุงุฎุชุจุงุฑ ุณุฑุนุฉ ุงูุงุณุชุนูุงู

**ุงููููุน:** Supabase Dashboard โ Performance

**ูุงุฐุง ุชุชููุน:**

```
Before Fix:
โโ Query: hv_payments with worker_id filter
โโ Time: 500-1000 ms
โโ Status: โ๏ธ SLOW / TIMEOUT
โโ Memory: 400-500 MB

After Fix:
โโ Query: hv_payments with worker_id filter
โโ Time: 50-150 ms
โโ Status: โ FAST
โโ Memory: 50-100 MB
```

**ุงูุชุญูู ูู ุงูุฃุฏุงุก:**

```sql
-- ุงุณุชุนูู ุนู ุฃุจุทุฃ ุงูุงุณุชุนูุงูุงุช
SELECT
  query,
  mean_exec_time,
  calls,
  total_exec_time
FROM pg_stat_statements
WHERE query LIKE '%hv_payments%'
ORDER BY mean_exec_time DESC
LIMIT 5;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**

```
mean_exec_time ูุฌุจ ุฃู ูููู < 100 ms (ูุงู > 500 ms ูุจู)
```

---

### 3๏ธโฃ ุงุฎุชุจุงุฑ ุงููุงุฌูุฉ (UI Test)

#### ุงูุงุฎุชุจุงุฑ 1: ุชุญููู ุชูุฑูุฑ ุงููุฏููุนุงุช

```
ุงูุฎุทูุงุช:
1. ุงุฐูุจ ุฅูู ุตูุญุฉ "Download Report" (ุฃู "ุชุญููู ุงูุชูุฑูุฑ")
2. ุงุฎุชุฑ ูุฑุน (ุฃู ูุฑุน)
3. ุงุฎุชุฑ ูุทุงู ุชุงุฑูุฎ (ูุซู ุขุฎุฑ 30 ููู)
4. ุงุถุบุท "Load Data" ุฃู "ุชุญููู ุงูุจูุงูุงุช"
5. ูุงุญุธ ุณุฑุนุฉ ุงูุชุญููู ูุงูุงุณุชุฌุงุจุฉ

ุงููุชูุฌุฉ ุงููุชููุนุฉ:
โโ โ ุงูุจูุงูุงุช ุชุญูู ุจุณุฑุนุฉ (< 2 ุซุงููุฉ)
โโ โ ูุง ุชุฌููุฏ ุงููุงุฌูุฉ
โโ โ ูุง ุฑุณุงุฆู ุฎุทุฃ
โโ โ ุงุณุชููุงู ุงูุฐุงูุฑุฉ ููุฎูุถ (ูุฑุงูุจ ุงููุชุตูุญ)
โโ โ ูุง ุงูููุงุฑ ุงูุฎุงุฏู
```

#### ุงูุงุฎุชุจุงุฑ 2: ุชุญููู ูุชุฒุงูู

```
ุงูุฎุทูุงุช:
1. ุงูุชุญ 3-4 ููุงูุฐ ูุชุตูุญ ูู ุงูุชุทุจูู
2. ุงุฎุชุฑ ููุณ ุงูุจูุงูุงุช ูู ูู ูุงูุฐุฉ
3. ุงุถุบุท "Load Data" ูู ุฌููุน ุงูููุงูุฐ ูู ููุณ ุงูููุช
4. ูุงุญุธ ุงูุฃุฏุงุก

ุงููุชูุฌุฉ ุงููุชููุนุฉ:
โโ โ ุฌููุน ุงูุทูุจุงุช ุชูุชูู ุจูุฌุงุญ
โโ โ ูุง timeout
โโ โ ูุง ุฑุณุงุฆู "Out of Memory"
โโ โ ุงูุฎุงุฏู ูุจูู ูุณุชูุฑุงู
```

---

### 4๏ธโฃ ูุฑุงูุจุฉ ุงูุฐุงูุฑุฉ

**ุงููููุน:** Supabase Dashboard โ Database โ Monitoring

**ูุง ูุฌุจ ูุฑุงูุจุชู:**

```
Connection Pool Memory:
โโ ูุจู: ูุตู ุฅูู 1700+ MB (ุซู ูููุงุฑ)
โโ ุจุนุฏ: ูุจูู ุฃูู ูู 500 MB โ

Shared Buffers Usage:
โโ ูุจู: 80-90% ูู ุงููุณุงุญุฉ
โโ ุจุนุฏ: 30-50% ูู ุงููุณุงุญุฉ โ

Query Execution Time:
โโ ูุจู: ูู ุงูุบุงูุจ > 500 ms
โโ ุจุนุฏ: ูู ุงูุบุงูุจ < 100 ms โ
```

---

### 5๏ธโฃ ูุญุต ุงูุฃุฏุงุก ูู ูุชุตูุญู

**ุฃุฏูุงุช ุงููุชุตูุญ (DevTools):**

```
ุงูุฎุทูุงุช:
1. ุงูุชุญ DevTools (F12)
2. ุงุฐูุจ ุฅูู Network tab
3. ุงุถุบุท ุนูู ุชุญููู ุงูุจูุงูุงุช
4. ูุงุญุธ ุงูุทูุจุงุช ุงููุฑุณูุฉ

ุงููุชูุฌุฉ ุงููุชููุนุฉ:
โโ Request: GET /api/payments?branchId=...
โโ Time: < 500 ms (ูุงู > 2s ูุจู)
โโ Size: < 2 MB (ูุงู > 10 MB ูุจู)
โโ Status: 200 OK
โโ Response Time: < 200 ms โ

Memory Tab:
โโ ูุจู: ูุฏ ูุตู ุฅูู 300+ MB ููุชุทุจูู
โโ ุจุนุฏ: ูุจูู ุฃูู ูู 50 MB โ
```

---

## ๐ ุงููุฑููุงุช ุงููุชููุนุฉ

### ุงุณุชููุงู ุงูููุงุฑุฏ

| ุงูููุงุฑุฏ                   | ูุจู ุงูุฅุตูุงุญ | ุจุนุฏ ุงูุฅุตูุงุญ | ุงูุชุญุณู       |
| ------------------------- | ----------- | ----------- | ------------ |
| **ุงุณุชููุงู ุงูุฐุงูุฑุฉ**       | 400-500 MB  | 50-100 MB   | **80%**      |
| **ููุช ุงูุงุณุชุนูุงู**         | 500-1000 ms | 50-150 ms   | **10x ุฃุณุฑุน** |
| **ุนุฏุฏ ุงูุตููู ุงูุงูุชุฑุงุถู**  | 10,000      | 1,000       | **80% ุฃูู**  |
| **ุนุฏุฏ ุงูุทูุจุงุช ุงููุชุฒุงููุฉ** | 2-3         | 10-15       | **5x ุฃูุซุฑ**  |

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูู ุชุญุณู ุงูุฃุฏุงุก

**ุงููุดููุฉ 1: ุงูููุงุฑุณ ูู ุชููุดุฃ**

```sql
-- ุชุญูู ูู ูุฌูุฏ ุงูููุงุฑุณ
SELECT COUNT(*) as index_count FROM pg_indexes
WHERE tablename = 'hv_payments';

-- ูุฌุจ ุฃู ูููู >= 5
```

**ุงูุญู:** ุฃุนุฏ ุชุดุบูู Migration ูุฏูููุง:

```sql
CREATE INDEX IF NOT EXISTS idx_hv_payments_worker_id ON public.hv_payments(worker_id);
CREATE INDEX IF NOT EXISTS idx_hv_payments_saved_at_desc ON public.hv_payments(saved_at DESC);
CREATE INDEX IF NOT EXISTS idx_hv_payments_worker_saved ON public.hv_payments(worker_id, saved_at DESC);
CREATE INDEX IF NOT EXISTS idx_hv_payments_verification_id ON public.hv_payments(verification_id);
CREATE INDEX IF NOT EXISTS idx_hv_payments_worker_saved_amount ON public.hv_payments(worker_id, saved_at DESC, amount);
```

**ุงููุดููุฉ 2: ุงูุงุณุชุนูุงูุงุช ูุง ุชุฒุงู ุจุทูุฆุฉ**

```sql
-- ุชุญูู ูู ุฃูููุง ุฃุจุทุฃ ุงุณุชุนูุงู
EXPLAIN ANALYZE
SELECT * FROM hv_payments
WHERE worker_id = 'some-id'
ORDER BY saved_at DESC
LIMIT 1000;

-- ูุฌุจ ุฃู ุชุฑู "Index Scan" ูููุณ "Seq Scan"
```

**ุงููุดููุฉ 3: ูุง ุชุฒุงู ููุงู ุฑุณุงุฆู OOM**

```sql
-- ุชุญูู ูู ุญุฌู ุงูุฌุฏูู
SELECT
  pg_size_pretty(pg_total_relation_size('hv_payments')) as total_size,
  COUNT(*) as row_count
FROM hv_payments;

-- ุฅุฐุง ูุงู Row Count > 1 ูููููุ ูุฏ ุชุญุชุงุฌ ุฅูู:
-- - ุฃุฑุดูุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ
-- - ุชูุณูู ุงูุฌุฏูู (Partitioning)
```

---

## ๐ ููุงุณ ุงูุชุญุณู

### ูุจู ูุจุนุฏ

**ูุจู ุงูุฅุตูุงุญ:**

```
ุชุญููู ุจูุงูุงุช ุงููุฏููุนุงุช (20,000 ุตู):
โโ ููุช ุงูุงูุชุธุงุฑ: 45 ุซุงููุฉ
โโ ุงุณุชููุงู ุงูุฐุงูุฑุฉ: 750 MB
โโ ุฑุณุงุฆู ุฎุทุฃ: "Out of Memory"
โโ ุญุงูุฉ ุงูุฎุงุฏู: ๐ด Crashed
โโ ุฅููุงููุฉ ุงููุตูู: โ ูุนุทู

```

**ุจุนุฏ ุงูุฅุตูุงุญ:**

```
ุชุญููู ุจูุงูุงุช ุงููุฏููุนุงุช (5,000 ุตู ุงูุชุฑุงุถูุ ูููู ุฒูุงุฏุฉ):
โโ ููุช ุงูุงูุชุธุงุฑ: 0.5 ุซุงููุฉ
โโ ุงุณุชููุงู ุงูุฐุงูุฑุฉ: 80 MB
โโ ุฑุณุงุฆู ุฎุทุฃ: โ ุจุฏูู ุฃุฎุทุงุก
โโ ุญุงูุฉ ุงูุฎุงุฏู: ๐ข ูุณุชูุฑ
โโ ุฅููุงููุฉ ุงููุตูู: โ ูุชุงุญ
```

---

## ๐ ุฅุฐุง ูุงุฌูุช ูุดุงูู

### ูุนูููุงุช ูููุฏุฉ ููุฅุจูุงุบ ุนู ุงููุดููุฉ:

1. **ููุทุงุช ุดุงุดุฉ:**
   - Supabase Performance Dashboard
   - Browser DevTools Memory
   - Error messages (if any)

2. **ุงูุณุฌูุงุช:**
   - Application console logs
   - Netlify function logs
   - Database query logs

3. **ูุนูููุงุช ุงููุธุงู:**
   - ุนุฏุฏ ุงูููุธููู ูู ุงููุฑุน
   - ูุทุงู ุงูุชูุงุฑูุฎ ุงููุณุชุฎุฏู
   - ุนุฏุฏ ุงููุฑูุน ุงููุณุชุฎุฏูุฉ

---

## โจ ุงูููุฎุต

ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:

1. โ 5 ููุงุฑุณ ุนูู ุฌุฏูู hv_payments
2. โ ุชูููู ุงูุญุฏ ุงูุงูุชุฑุงุถู ูู 10k ุฅูู 1k ุตู
3. โ ุฅุนุงุฏุฉ ููููุฉ ุงูุงุณุชุนูุงู ูุงุณุชุฎุฏุงู indexed lookups
4. โ ูุธุงู ุชุฎุฒูู ูุคูุช ูุชูุฏู ููุจูุงูุงุช ุงูุซูููุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**

- ๐ข ูุง ูุฒูุฏ ูู Out of Memory crashes
- ๐ข ุฃุฏุงุก ุฃุณุฑุน 10 ูุฑุงุช
- ๐ข ุงุณุชููุงู ุฐุงูุฑุฉ ุฃูู 80%
- ๐ข ูุธุงู ูุณุชูุฑ ูููุซูู
